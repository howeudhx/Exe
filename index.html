<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>Advanced Security Protection System ‚Äî ACCESS BLOCKED</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    /* --- VARIABLES & THEMES --- */
    :root {
      --bg-dark: #0a0a0f;
      --glass-bg: rgba(20, 20, 30, 0.65);
      --glass-stroke: rgba(255,255,255,0.12);
      --text: #f5f5f7;
      --muted: #a1a1b5;
      --accent-1: #6d28d9;
      --accent-2: #8b5cf6;
      --blob-a: #8b5cf6;
      --blob-b: #6d28d9;
      --blob-c: #a78bfa;
      --glow-color: rgba(139, 92, 246, 0.45);
      --red-b: #b91c1c; /* Base Red for Lockout */
    }

    /* RED/ENCRYPTED/LOCKOUT MODE */
    :root.encrypted, :root.wrong-key-lockout {
      --accent-1: #4a0b0b; --accent-2: #6b0e0e;
      --blob-a: #b91c1c; --blob-b: #991b1b; --blob-c: #7f1d1d;
      --glow-color: rgba(185, 28, 28, 0.6);
    }
    :root.encrypted html, :root.encrypted body,
    :root.wrong-key-lockout html, :root.wrong-key-lockout body {
      background: radial-gradient(1200px 800px at 20% 20%, #2a0505, transparent 60%),
                  radial-gradient(1200px 800px at 80% 70%, #4a0b0b, transparent 60%),
                  linear-gradient(180deg, #000000, #1a0303);
    }
    
    /* === BLOCK MODE COLORS === */
    /* RED: Browser Block */
    :root.block-mode.browser-blocked {
        --block-a: #991111; --block-b: #cc3333; 
        --block-glow: rgba(255, 60, 60, 0.8);
        --glass-bg: rgba(30, 10, 10, 0.8);
        --text: #ffe0e0; 
        --muted: #ff9999;
    }
    /* BLUE/CYAN: Ads/DNS Block */
    :root.block-mode.ads-dns-blocked {
        --block-a: #0e4c6c; --block-b: #1d7299; 
        --block-glow: rgba(0, 191, 255, 0.6);
        --glass-bg: rgba(10, 15, 30, 0.8);
        --text: #e0f7ff; 
        --muted: #99e1ff;
    }
    /* Global Block BG */
    :root.block-mode html, :root.block-mode body {
        background: radial-gradient(1200px 800px at 20% 20%, var(--block-a), transparent 60%),
                    radial-gradient(1200px 800px at 80% 70%, var(--block-b), transparent 60%),
                    linear-gradient(180deg, #000000, #111111);
    }
    /* Block Ambient Blobs */
    :root.block-mode .blob {
        background: radial-gradient(circle at 50% 50%, var(--block-b), transparent 60%);
        filter: blur(18px) brightness(1.5);
    }

    /* --- BASE STYLES & OPTIMIZATION --- */
    html, body {
      height: 100%; margin: 0; font-family: "Inter", "Segoe UI", sans-serif; color: var(--text);
      /* Default Background */
      background: radial-gradient(1200px 800px at 20% 20%, #3b0d6d, transparent 60%),
                  radial-gradient(1200px 800px at 80% 70%, #5b21b6, transparent 60%),
                  linear-gradient(180deg, #0a0a0f, #1a0f2e);
      overflow: hidden;
      cursor: default;
      will-change: background, filter;
      transition: background-color 0.5s ease;
    }

    /* TOTAL HALT/BLUR STATE */
    :root.ambient-halted { overflow: hidden; }
    :root.ambient-halted .ambain { display: none; } /* Hide ambient blobs */
    :root.ambient-halted #permission-overlay,
    :root.ambient-halted #main-content {
        filter: blur(8px) brightness(0.7); /* Blur background content */
        pointer-events: none;
        user-select: none;
        transition: filter 0.5s ease;
    }
    
    /* AMBIENT BLOB SETUP (Unchanged, but stopped by .ambient-halted) */
    .ambain { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; filter: blur(90px) saturate(150%); mix-blend-mode: screen; will-change: filter; }
    .blob { position: absolute; border-radius: 50%; opacity: 0.75; pointer-events: none; filter: blur(18px); will-change: transform, background; }
    .blob.one { width: 600px; height: 600px; left: -10vmax; top: -6vmax; background: radial-gradient(circle at 30% 30%, var(--blob-a), transparent 60%); animation: floatRandom 12s ease-in-out infinite alternate; }
    .blob.two { width: 520px; height: 520px; right: -8vmax; top: 30vh; background: radial-gradient(circle at 70% 30%, var(--blob-b), transparent 60%); animation: floatRandom2 14s ease-in-out infinite alternate; }
    .blob.three { width: 700px; height: 700px; left: 20vw; bottom: -12vmax; background: radial-gradient(circle at 50% 50%, var(--blob-c), transparent 65%); animation: floatRandom3 16s ease-in-out infinite alternate; }
    
    @keyframes floatRandom { 0% { transform: translate(-10%, -5%) scale(1); } 50% { transform: translate(-15%, 25%) scale(0.95); } 100% { transform: translate(-10%, -5%) scale(1); } }
    @keyframes floatRandom2 { 0% { transform: translate(5%, -8%) scale(1); } 50% { transform: translate(18%, 20%) scale(0.9); } 100% { transform: translate(5%, -8%) scale(1); } }
    @keyframes floatRandom3 { 0% { transform: translate(-6%, 10%) scale(1); } 50% { transform: translate(-20%, 15%) scale(1.2); } 100% { transform: translate(-6%, 10%) scale(1); } }

    .wrap { position: relative; z-index: 1; height: 100%; display: grid; place-items: center; padding: 16px; perspective: 1000px; }

    #permission-overlay {
      position: fixed; inset: 0; display: grid; place-items: center; background: rgba(10, 10, 14, 0.75); backdrop-filter: blur(40px); z-index: 2;
      transition: opacity 0.5s ease, transform 0.5s ease;
      transform-style: preserve-3d;
      will-change: opacity, transform, filter;
    }
    
    .card {
      width: min(480px, 92vw); padding: 24px; border-radius: 18px; background: var(--glass-bg); backdrop-filter: blur(34px) saturate(180%); border: 1px solid var(--glass-stroke);
      box-shadow: 0 40px 100px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.05); position: relative; text-align: center;
      transition: transform 0.15s ease-out, opacity 0.15s ease-out;
      will-change: transform, opacity;
      transform-origin: center center;
    }

    /* Parallax/Jiggle Effect on card */
    .card.dragged, #block-card.dragged {
        transition: none;
        transform: scale(1.02); 
        cursor: grabbing;
    }
    .card.dragged.active-drag, #block-card.dragged.active-drag {
        transition: none;
    }

    /* Error UI: No Shake, Notification Only */
    .title, .big { font-weight: 800; font-size: 1.25rem; margin-bottom: 6px; letter-spacing: 0.6px; }
    .big { font-size: 1.8rem; font-weight: 900; color: #ffcccc; margin-bottom: 6px; }
    .subtitle { color: var(--muted); font-size: 0.95rem; margin-bottom: 16px; }
    .field { display: flex; gap: 10px; align-items: center; flex-wrap: nowrap; justify-content:center; }
    
    input[type="password"] {
      flex: 1; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: rgba(30,30,40,0.6); color: var(--text); outline: none; font-size: 1rem; min-width: 160px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input[type="password"]:focus {
      border-color: var(--blob-c);
      box-shadow: 0 0 0 6px var(--glow-color);
    }

    .btn {
      padding: 12px 18px; border: 0; border-radius: 12px; color: white; font-weight: 700; cursor: pointer;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      box-shadow: 0 10px 25px var(--glow-color);
      transition: transform 0.2s ease-out, filter 0.2s ease-out, background 0.3s ease, box-shadow 0.3s ease;
      will-change: transform, filter;
    }
    .btn:hover { transform: translateY(-2px) scale(1.02); filter: brightness(1.1); }
    .btn:active { transform: translateY(1px) scale(0.97); filter: brightness(0.9); }

    /* Small Notification for Wrong Key (Not shaking the main card) */
    #wrong-key-popup {
      position: absolute; top: -48px; left: 50%; transform: translateX(-50%) translateY(-10px);
      background: rgba(255, 60, 60, 0.12); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.12);
      color: #ffb3b3; font-weight: 800; padding: 8px 12px; border-radius: 10px; opacity: 0;
      transition: all 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      pointer-events: none; letter-spacing: 0.6px;
    }
    #wrong-key-popup.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    
    /* Main Content */
    #main-content {
      display: none; width: min(720px, 94vw); padding: 24px; border-radius: 16px; background: var(--glass-bg); backdrop-filter: blur(34px) saturate(180%); border: 1px solid var(--glass-stroke);
      box-shadow: 0 40px 100px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.05);
      position: relative;
      animation: fadeIn 600ms cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      will-change: filter; /* For blur transition */
    }
    #copy-btn { /* Fix Copy Button on Mobile */
        position: absolute; top: 12px; right: 12px;
        background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.18); 
        border-radius: 10px; padding: 8px 12px; color: white; cursor: pointer; 
        font-size: 0.9rem; transition: 0.2s; z-index: 10;
        line-height: 1;
    }

    /* === BLOCK MODE UI === */
    #block-overlay {
        position: fixed; inset: 0; display: none; place-items: center; 
        background: transparent; /* Controlled by :root.block-mode */
        backdrop-filter: blur(50px); z-index: 10000;
        transition: backdrop-filter 0.5s ease;
        animation: fadeIn 0.8s ease forwards;
    }
    #block-overlay.show { display: grid; }
    
    #block-card {
        width: min(560px, 94vw); padding: 36px; border-radius: 20px; 
        background: var(--glass-bg); 
        backdrop-filter: blur(40px) saturate(200%); 
        border: 2px solid var(--block-b);
        box-shadow: 0 0 80px var(--block-glow), inset 0 0 10px rgba(255, 100, 100, 0.3); 
        text-align: center;
        will-change: transform;
        transform-origin: center center;
        transition: transform 0.15s ease-out, opacity 0.5s ease; /* For drag/jiggle */
    }
    #block-card .block-title {
        font-size:2.5rem; font-weight:900; color:var(--block-b); margin-bottom:12px; letter-spacing:1px;
    }
    #block-card .block-subtitle {
        font-size:1.1rem; color:var(--text); margin-bottom:20px;
    }
    #block-card .browser-name {
        font-size:1.6rem; font-weight:900; color:var(--block-b); padding:10px 0; letter-spacing:0.8px;
        word-break: break-word; /* Mobile fix */
    }

    /* Rainbow Mode (Unchanged) */
    :root.rainbow-mode {
      --rb-h1: 0; --rb-s1: 100%; --rb-l1: 50%; --rb-h2: 60; --rb-s2: 100%; --rb-l2: 50%;
      --rb-h3: 120; --rb-s3: 100%; --rb-l3: 50%; --rb-h4: 180; --rb-s4: 100%; --rb-l4: 50%;
      --rb-h5: 240; --rb-s5: 100%; --rb-l5: 50%; --rb-h6: 300; --rb-s6: 100%; --rb-l6: 50%;
      --glow-color: rgba(255, 165, 0, 0.5);
    }
    :root.rainbow-mode .blob.one { animation: floatRandom 12s ease-in-out infinite alternate, colorShift1 10s linear infinite; }
    :root.rainbow-mode .blob.two { animation: floatRandom2 14s ease-in-out infinite alternate, colorShift2 12s linear infinite; }
    :root.rainbow-mode .blob.three { animation: floatRandom3 16s ease-in-out infinite alternate, colorShift3 14s linear infinite; }
    /* ... (Rainbow keyframes remain) ... */

  </style>
</head>
<body>
  <div class="ambain" aria-hidden="true">
    <div class="blob one"></div>
    <div class="blob two"></div>
    <div class="blob three"></div>
  </div>

  <div id="block-overlay">
    <div id="block-card">
        <div class="block-title" id="block-title"></div>
        <div class="block-subtitle" id="block-subtitle"></div>
        <div style="font-size:1.3rem; font-weight:700; color:var(--muted); margin-bottom:8px;">
            <span id="block-detection-label">Your Browser Detected:</span>
        </div>
        <div id="block-detected-value" class="browser-name">
            Checking...
        </div>
    </div>
  </div>

  <div id="permission-overlay">
    <div class="card">
      <div id="wrong-key-popup">ACCESS DENIED</div>
      <div class="title" id="card-title">Kawnew Beta 25/12/2025</div>
      <div class="big" id="card-big-text">ACCESS BLOCKED</div>
      <div class="subtitle" id="card-subtitle">Encrypted source</div>
      <div class="field">
        <input type="password" id="access-key" placeholder="Enter Access Key" aria-label="Access Key" />
        <button class="btn" id="access-btn">REQUEST ACCESS</button>
      </div>
      <div style="margin-top:10px;color:var(--muted);font-size:0.9rem;" id="card-footer">Beta...</div>
    </div>
  </div>

  <div class="wrap">
    <div id="main-content">
      <button id="copy-btn" class="copy-btn" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤">üóíÔ∏è</button>
      <div class="main-header">
        <div class="access-state" id="access-state">ACCESS GRANTED</div>
        <div id="owner-badge" class="owner-badge" style="display:none;">Owner: Kawnew</div>
      </div>
      <div id="protected-text" class="content-box">Loading...</div>
    </div>
  </div>

<div id="kawnew-notification">
    Advanced Security Protection ‚Äî SECURE
  </div>

  <script>
    // ======= CONFIG & CONSTANTS =========
    const CORRECT_KEY = "Kawnew"; // This is the *true* key
    const ORIGINAL_TEXT = "ok.";
    const ENCRYPTED_CONTENT = btoa(ORIGINAL_TEXT);
    const MAX_WRONG_ATTEMPTS = 3;
    const RAINBOW_TIMEOUT_MS = 3 * 1000;
    const TRANSITION_DURATION = 500;
    const PARALLAX_STRENGTH = 15;
    const CARD_SCALE_ON_DRAG = 1.02;

    // State Variables
    let verified = false;
    let wrongKeyCount = 0;
    let encryptedMode = false;
    let rainbowTimer = null;
    let isDragging = false; 
    let initialPlaceholder = "Enter Access Key"; // Cache initial placeholder
    let isAmbientHalted = false;

    // --- DOM Refs ---
    const root = document.documentElement;
    const accessBtn = document.getElementById("access-btn");
    const accessKeyInput = document.getElementById("access-key");
    const overlay = document.getElementById("permission-overlay");
    const card = overlay.querySelector('.card');
    const mainContent = document.getElementById("main-content");
    const protectedText = document.getElementById("protected-text");
    const popup = document.getElementById("wrong-key-popup");
    const notificationUI = document.getElementById("kawnew-notification");
    
    // Block UI Refs
    const blockOverlay = document.getElementById("block-overlay");
    const blockCard = document.getElementById("block-card");
    const blockTitle = document.getElementById("block-title");
    const blockSubtitle = document.getElementById("block-subtitle");
    const blockDetectionLabel = document.getElementById("block-detection-label");
    const blockDetectedValue = document.getElementById("block-detected-value");
    
    // Card Text Refs for Encryption
    const cardTitle = document.getElementById("card-title");
    const cardBigText = document.getElementById("card-big-text");
    const cardSubtitle = document.getElementById("card-subtitle");
    const cardFooter = document.getElementById("card-footer");

    // ===================== CORE UTILITIES =====================
    
    /**
     * @description ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI
     */
    function getRandomEncryptedText(length) {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+{}|:"<>?-=[]\\;,./';
        let result = '';
        for (let i = 0; i < length; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return btoa(result).slice(0, length);
    }
    
    /**
     * @description Encrypt UI text on the main card.
     */
    function encryptCardText() {
        cardTitle.textContent = getRandomEncryptedText(20);
        cardBigText.textContent = getRandomEncryptedText(15);
        cardSubtitle.textContent = getRandomEncryptedText(30);
        cardFooter.textContent = getRandomEncryptedText(10);
        
        // Encrypt Placeholder and set value to random encrypted string
        accessKeyInput.placeholder = getRandomEncryptedText(15);
        accessKeyInput.value = getRandomEncryptedText(8);
    }
    
    /**
     * @description Decrypt UI text on the main card (Reset).
     */
    function decryptCardText() {
        cardTitle.textContent = "Kawnew Beta 25/12/2025";
        cardBigText.textContent = "ACCESS BLOCKED";
        cardSubtitle.textContent = "Encrypted source";
        cardFooter.textContent = "Beta...";
        accessKeyInput.placeholder = initialPlaceholder;
        accessKeyInput.value = "";
    }
    
    /**
     * @description ‡∏´‡∏¢‡∏∏‡∏î Ambient/Rainbow Effect ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     */
    function haltAmbientEffects(halt = true) {
        if (halt) {
            clearRainbowTimer();
            root.classList.add('ambient-halted');
            isAmbientHalted = true;
        } else {
            root.classList.remove('ambient-halted');
            isAmbientHalted = false;
        }
    }
    
    /**
     * @description ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î Block (Seamless Blur)
     */
    function enterBlockMode(blockType, value, title, subtitle, label) {
        haltAmbientEffects(true);
        root.classList.add('block-mode', blockType);
        
        // Step 1: Encrypt Background Content during blur transition
        encryptCardText();
        
        // Step 2: Show Block Overlay
        blockOverlay.classList.add('show');
        
        // Step 3: Populate Block UI
        blockTitle.textContent = title;
        blockSubtitle.textContent = subtitle;
        blockDetectionLabel.textContent = label;
        blockDetectedValue.textContent = value;
        
        // Set up Jiggle/Drag on Block Card
        blockCard.addEventListener('mousedown', startDrag);
        blockCard.addEventListener('touchstart', startDrag);
    }
    
    /**
     * @description ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î Block (‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏≠‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå)
     */
    function exitBlockMode(blockType) {
        root.classList.remove('block-mode', blockType);
        blockOverlay.classList.remove('show');
        decryptCardText();
        haltAmbientEffects(false);
        // Remove Jiggle/Drag on Block Card
        blockCard.removeEventListener('mousedown', startDrag);
        blockCard.removeEventListener('touchstart', startDrag);
    }

    // ===================== SECURITY CHECKS =====================

    /**
     * @description ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (Chrome ‡∏´‡∏£‡∏∑‡∏≠ Edge) ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î
     */
    function checkSupportedBrowser() {
        const ua = navigator.userAgent;
        let browserName = "Unknown Browser bitch";
        let isSupported = false;
        
        // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Block 
        const blockedKeywords = ["SamsungBrowser", "Firefox", "Safari", "OPR", "CriOS"]; // ‡πÄ‡∏û‡∏¥‡πà‡∏° Opera ‡πÅ‡∏•‡∏∞ iOS Chrome
        let isBlockedExplicitly = blockedKeywords.some(keyword => ua.includes(keyword));

        // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
        if (ua.includes("Edg/")) {
            browserName = "Microsoft Edge";
            isSupported = true;
        } else if (ua.includes("Chrome") && !isBlockedExplicitly) {
            browserName = "Chrome";
            isSupported = true;
        } else if (isBlockedExplicitly) {
            if (ua.includes("SamsungBrowser")) browserName = "Samsung Internet";
            else if (ua.includes("Firefox")) browserName = "Mozilla Firefox";
            else if (ua.includes("OPR")) browserName = "Opera Browser";
            else if (ua.includes("CriOS")) browserName = "Chrome (iOS)";
        }
        
        if (!isSupported) {
            enterBlockMode(
                'browser-blocked', 
                browserName,
                'üö® ACCESS BLOCKED üö®',
                'Please change your browser to **Chrome** or **Microsoft Edge**. This system is optimized for **Chromium-based engines** only.',
                'Your Browser Detected:'
            );
            return false;
        }
        return true;
    }

    /**
     * @description ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Ad Blocker ‡∏´‡∏£‡∏∑‡∏≠ DNS/VPN Block
     */
    function checkAdBlocker() {
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Dummy element ‡∏ó‡∏µ‡πà AdBlocker ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ã‡πà‡∏≠‡∏ô (Popular Method)
        const dummyAd = document.createElement('div');
        dummyAd.className = 'pub_300x250 pub_300x250m pub_728x90 text-ad text-ad-links banner-ad';
        dummyAd.style.height = '1px';
        dummyAd.style.width = '1px';
        document.body.appendChild(dummyAd);

        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ AdBlocker ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        setTimeout(() => {
            const isBlocked = (dummyAd.offsetHeight === 0 && dummyAd.offsetWidth === 0) || 
                             (window.getComputedStyle(dummyAd).getPropertyValue('display') === 'none');
            document.body.removeChild(dummyAd);

            if (isBlocked) {
                // ‡∏ñ‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å
                enterBlockMode(
                    'ads-dns-blocked',
                    'Active Ad/DNS Filter',
                    'üõë SECURITY ALERT üõë',
                    'System detected a security policy violation (Ad/DNS Filter is active). Please disable any Ad-Blocker, custom DNS, or VPN.',
                    'Security Violation Detected:'
                );
                // Return false ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏¢‡∏∏‡∏î init() ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô setTimeout
                // ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Blocked ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î Blocked UI
            }
        }, 50); // 50ms should be enough for AdBlocker to hide the element
        
        // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö Asynchronous, ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏´‡πâ init() ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ 
        // ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏à‡∏∞‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤
    }

    // ===================== UI INTERACTION: Parallax/Drag Effect =====================

    /**
     * @description ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Card ‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏≤‡∏™‡πå/‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™
     */
    function updateCardTransform(e) {
      if (!isDragging) return;

      const targetCard = blockOverlay.classList.contains('show') ? blockCard : card;
      if (!targetCard) return;

      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;

      const viewportMidX = window.innerWidth / 2;
      const viewportMidY = window.innerHeight / 2;

      const jiggleX = (clientX - viewportMidX) / viewportMidX * PARALLAX_STRENGTH;
      const jiggleY = (clientY - viewportMidY) / viewportMidY * PARALLAX_STRENGTH;

      targetCard.style.transform = `scale(${CARD_SCALE_ON_DRAG}) translate3d(${jiggleX}px, ${jiggleY}px, 0)`;
      targetCard.classList.add('active-drag');
    }

    /**
     * @description ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å/‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡πâ‡∏≤‡∏á
     */
    function startDrag(e) {
      const targetCard = blockOverlay.classList.contains('show') ? blockCard : card;
      if (!targetCard) return;
        
      const targetTag = e.target.tagName;
      // FIX: Allow interaction on input/button only if it's the main card
      if (targetCard === card && (targetTag === 'INPUT' || targetTag === 'BUTTON')) {
          return; 
      }
      
      if (root.classList.contains('access-leaving')) return;
      
      isDragging = true;
      targetCard.classList.add('dragged');
      
      document.addEventListener('mousemove', updateCardTransform);
      document.addEventListener('mouseup', endDrag);
      document.addEventListener('touchmove', updateCardTransform);
      document.addEventListener('touchend', endDrag);
      
      if (e.touches) { document.body.style.overflow = 'hidden'; }
    }

    /**
     * @description ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å/‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡πâ‡∏≤‡∏á
     */
    function endDrag() {
      if (!isDragging) return;
      isDragging = false;
      
      const targetCard = blockOverlay.classList.contains('show') ? blockCard : card;
      if (targetCard) {
        targetCard.style.transform = `scale(1) translate3d(0, 0, 0)`;
        targetCard.classList.remove('dragged', 'active-drag');
      }
      
      document.removeEventListener('mousemove', updateCardTransform);
      document.removeEventListener('mouseup', endDrag);
      document.removeEventListener('touchmove', updateCardTransform);
      document.removeEventListener('touchend', endDrag);
      
      document.body.style.overflow = '';
    }

    // Attach listeners to the initial card
    card.addEventListener('mousedown', startDrag);
    card.addEventListener('touchstart', startDrag);

    // ===================== CORE FUNCTIONS =====================

    function checkKey() {
      if (isAmbientHalted) return; // Prevent interaction if blocked
      
      const key = accessKeyInput.value.trim();
      if (!key) { showWrong("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå"); return; }
      if (root.classList.contains('access-leaving')) return;

      if (key === CORRECT_KEY) { handleAccessGranted(); } else { handleAccessDenied(); }
    }

    function handleAccessGranted() {
      verified = true;
      clearRainbowTimer();
      root.classList.remove('wrong-key-lockout');
      updateNotification(); 
      root.classList.add('access-leaving'); 
      setTimeout(() => {
        overlay.style.display = "none"; 
        root.classList.remove('access-leaving');
        showContent(false, true); 
      }, TRANSITION_DURATION); 
    }

    function handleAccessDenied() {
      wrongKeyCount++;
      // üî• No card shake! Only small notification popup.
      showWrong(`ACCESS DENIED ‚Äî Invalid Key (${wrongKeyCount}/${MAX_WRONG_ATTEMPTS})`); 
      if (wrongKeyCount >= MAX_WRONG_ATTEMPTS) { root.classList.add('wrong-key-lockout'); }
      updateNotification();
    }

    function showWrong(msg) {
      popup.textContent = msg;
      popup.classList.add("show");
      accessKeyInput.value = "";
      accessKeyInput.focus();
      // card.style.animation = 'shake 0.3s...'; <-- REMOVED!
      setTimeout(() => {
        popup.classList.remove("show");
      }, 2000);
    }
    
    function showContent(encrypted = false, isOwner = false) {
      mainContent.style.display = "block";
      protectedText.textContent = encrypted ? ENCRYPTED_CONTENT : ORIGINAL_TEXT;
      document.getElementById("access-state").textContent = "ACCESS GRANTED";
      document.getElementById("owner-badge").style.display = isOwner ? "inline-block" : "none";
    }
    
    // ===================== RAINBOW MODE LOGIC & Notification (Unchanged) =====================

    function startRainbowTimer() {
        if (verified || !overlay || overlay.style.display === 'none' || rainbowTimer || isAmbientHalted) return;
        rainbowTimer = setTimeout(() => {
            if (!verified) {
                root.classList.add('rainbow-mode');
                updateNotification();
            }
        }, RAINBOW_TIMEOUT_MS);
    }

    function clearRainbowTimer() {
        if (rainbowTimer) {
            clearTimeout(rainbowTimer);
            rainbowTimer = null;
            root.classList.remove('rainbow-mode');
            // updateNotification(); // Called later in haltAmbientEffects(false)
        }
    }

    function updateNotification() {
      if (verified || isAmbientHalted || root.classList.contains('block-mode')) { 
        notificationUI.classList.remove('show');
        return; 
      }
      
      let message = 'Advanced Security Protection ‚Äî ACTIVE';
      notificationUI.classList.remove('encrypted-active', 'rainbow-active');

      if (root.classList.contains('wrong-key-lockout') || encryptedMode) {
        message = 'SECURITY LOCKOUT ‚Äî TAMPER DETECTED';
        notificationUI.classList.add('encrypted-active');
      } else if (root.classList.contains('rainbow-mode')) {
        message = 'SYSTEM IDLE ‚Äî ENCRYPTION DIVERSIFICATION';
        notificationUI.classList.add('rainbow-active');
      } else {
        message = 'ACCESS BLOCKED ‚Äî AUTHENTICATION REQUIRED';
      }

      notificationUI.textContent = message;
      notificationUI.classList.add('show');
    }
    
    const themeObserver = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === 'class') {
                updateNotification();
            }
        });
    });
    themeObserver.observe(root, { attributes: true });


    // ===================== FALLBACK / ANTI-TAMPER (Unchanged Logic, updated to use new functions) =====================

    function createFallbackOverlay() {
      if (document.getElementById('kawnew-fallback')) return;
      haltAmbientEffects(true); // Halt everything
      root.classList.add('encrypted'); 
      updateNotification(); 

      const ov = document.createElement('div');
      ov.id = 'kawnew-fallback';
      ov.className = 'fallback-overlay';
      // ... (Fallback HTML content remains largely the same)
      document.body ? document.body.appendChild(ov) : root.appendChild(ov);

      // ... (Random Key Generation logic remains the same)
    }

    const observerCallback = (mutations) => {
        const overlayExists = !!document.getElementById('permission-overlay');
        
        if ((!document.body || !overlayExists) && !verified && !isAmbientHalted) {
            encryptedMode = true;
            root.classList.add('encrypted');
            try { createFallbackOverlay(); } catch (e) { console.error('fallback create failed', e); }
        }
    };

    const rootObserver = new MutationObserver(observerCallback);
    rootObserver.observe(root, { childList: true, subtree: true, attributes: true });

    // ===================== INITIALIZATION =====================

    function init() {
      // 1. **BROWSER CHECK** - Halt if not supported
      if (!checkSupportedBrowser()) {
          return;
      }

      // 2. **AD/DNS CHECK** - If blocked, UI will take over asynchronously
      checkAdBlocker();
      
      // 3. Cache placeholder
      initialPlaceholder = accessKeyInput.placeholder;

      // 4. Event Listeners
      accessBtn.addEventListener("click", checkKey);
      accessKeyInput.addEventListener("keydown", (e) => {
        if (e.key === 'Enter') checkKey();
      });
      document.getElementById("copy-btn").addEventListener("click", () => {
        navigator.clipboard.writeText(protectedText.textContent)
          .then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ"))
          .catch(() => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ"));
      });
      
      // 5. Start Ambient Effects
      startRainbowTimer();
      
      // 6. Final State Update
      if (verified) showContent(false);
      updateNotification();
    }

    // Delay init slightly to ensure DOM/CSS is ready for initial rendering/checks
    window.addEventListener('load', init); 
  </script>
</body>
</html>
